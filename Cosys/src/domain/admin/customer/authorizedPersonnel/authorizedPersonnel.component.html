<form [formGroup]='authorizedPersonnelForm'>
  <ngc-titlebar title='admin.authorizedPersonal.title' (save)='onSave($event)' (cancel)='onCancel($event)'>
  </ngc-titlebar>
  <ngc-container type="tab">
    <ngc-row>
      <ngc-column>
        <ngc-label label='g.companyCode'></ngc-label>
        <div>
          <ngc-lov formControlName='companyCode' upperCase='true' sourceId='COMPANY_DEREGISTER' title='g.companyCode'
            dataField='code' (select)='onCompanyLOVSelect($event)' valueMember="code" [dropDownWidth]='70'
            accessEnableOn="r" required>
            <ngc-data-column text='g.companyCode' dataField='code' [width]='180'></ngc-data-column>
            <ngc-data-column text='g.companyName' dataField='desc' [width]='180'></ngc-data-column>
          </ngc-lov>
        </div>
      </ngc-column>
      <ngc-column>
        <ngc-label label='g.companyName'></ngc-label>
        <!-- <div>
                <ngc-display ngc-form-control formControlName="companyCode"></ngc-display>
              </div> -->
        <div>
          <ngc-lov formControlName='companyName' upperCase='true' sourceId='COMPANY_DEREGISTER_NAME'
            title='g.companyName' dataField='desc' (select)='onCompanyNameLOVSelect($event)' valueMember="desc"
            [dropDownWidth]='100' accessEnableOn="r" required>
            <ngc-data-column text='g.companyName' dataField='desc' [width]='150'></ngc-data-column>
            <ngc-data-column text='g.companyCode' dataField='code' [width]='100'></ngc-data-column>
          </ngc-lov>
        </div>
      </ngc-column>

      <ngc-column>
        <ngc-label label='admin.authorized.person.name'></ngc-label>
        <div>
          <ngc-lov formControlName='authorizedPersonnelNametxt' upperCase='true'
            sourceId='AUTHORIZED_PERSONNEL_NAMES_LIST' [sourceParameters]="authorizedPersonnelNameParams"
            sourceType='query' [noCache]="true" title='admin.authorized.person.name' dataField='code' valueMember="code"
            patternName='alphanumspace' entityAttribute="Customer.AuthorisedPersonNameSearch">
            <ngc-data-column text='admin.authorized.person.name' dataField='code' [width]='150'
              entityAttribute="Customer.AuthorisedPersonNameSearch"></ngc-data-column>
          </ngc-lov>
          <!--<ngc-input [width]='240' upperCase='true' ngc-form-control formControlName="authorizedPersonnelNametxt" accessEnableOn="r"></ngc-input>-->
        </div>
      </ngc-column>

      <ngc-column>
        <ngc-label entityAttribute="Customer.PersonalIdentificationNumberSearch">
        </ngc-label>
        <!-- label='customer.ic.fin.number' -->
        <div>
          <ngc-lov formControlName='authorizedPersonnelNumberTxt' upperCase='true'
            sourceId='AUTHORIZED_PERSONNEL_ICFIN_LIST' [sourceParameters]="authorizedPersonnelNumberParams"
            sourceType='query' [noCache]="true" title='admin.authorized.person.icfin.number' dataField='code'
            valueMember="code" entityAttribute="Customer.PersonalIdentificationNumberSearch">
            <ngc-data-column text='admin.icfin.number' dataField='code' [width]='150'
              entityAttribute="Customer.PersonalIdentificationNumberSearch">
            </ngc-data-column>
          </ngc-lov>

          <!--<ngc-input [width]='240' upperCase='true' ngc-form-control formControlName="authorizedPersonnelNametxt" accessEnableOn="r"></ngc-input>-->
        </div>
        <!--<font size="-2"><i>(Last five characters)</i></font>-->
      </ngc-column>

      <ngc-column>
        <ngc-label entityAttribute="Customer.AirportPassNumber"></ngc-label>
        <!-- label='customer.airport.pass.number' -->
        <div>
          <ngc-lov formControlName='airportPassNumberTxt' upperCase='true'
            sourceId='AUTHORIZED_PERSONNEL_AIRPORTPASS_LIST' [sourceParameters]="airportPassNumberParams"
            sourceType='query' [noCache]="true" title='admin.authorized.airport.pass.number' dataField='code'
            valueMember="code" entityAttribute="Customer.AirportPassNumber" patternName='alphanum'>
            <ngc-data-column text='admin.airportpass.number' dataField='code' [width]='150'
              entityAttribute="Customer.AirportPassNumber"></ngc-data-column>
          </ngc-lov>
          <!-- <ngc-lov formControlName='airportPassNumberTxt' upperCase='true' placeHolder="admin.last.four.characters"
            sourceId='AUTHORIZED_PERSONNEL_AIRPORTPASS_LIST' [sourceParameters]="airportPassNumberParams" sourceType='query'
            [noCache]="true" title='admin.authorized.airport.pass.number' dataField='code' valueMember="code" [maxlength]="4"
            [minlength]="4">
            <ngc-data-column text='admin.airportpass.number' dataField='code' [width]='150' placeHolder="Last four characters">
            </ngc-data-column>
          </ngc-lov> -->
          <!--<ngc-input [width]='240' upperCase='true' ngc-form-control formControlName="authorizedPersonnelNametxt" accessEnableOn="r"></ngc-input>-->
        </div>
        <!--<font size="-2"><i>(Last five characters)</i></font>-->
      </ngc-column>
      <ngc-column>
        <ngc-label label='customer.contractor.company.code'></ngc-label>
        <div>
          <ngc-lov formControlName='contractorCodeLOV' upperCase='true' sourceId='COMPANY_CONTRACTOR_LIST'
            [sourceParameters]="contractorCodeParams" sourceType='query' title='g.contractorCode' dataField='code'
            (select)='onContractorCodeSelect($event)' valueMember="code" accessEnableOn="r">
            <ngc-data-column text='customer.contractor.company.code' dataField='code' [width]='150'></ngc-data-column>
            <ngc-data-column text='customer.contractor.company.name' dataField='desc' [width]='150'></ngc-data-column>
          </ngc-lov>
        </div>
      </ngc-column>
      <ngc-column>
        <ngc-label label='customer.contractor.company.name'></ngc-label>
        <div>
          <ngc-lov formControlName='contractorNameLOV' width='270px' upperCase='true' sourceId='COMPANY_CONTRACTOR_LIST'
            [sourceParameters]="contractorNameParams" sourceType='query' title='g.contractorName' dataField='desc'
            (select)='onContractorNameSelect($event)' valueMember="desc" accessEnableOn="r">

            <ngc-data-column text='g.contractorName' dataField='desc' [width]='150'></ngc-data-column>
            <ngc-data-column text='g.contractorCode' dataField='code' [width]='150'></ngc-data-column>

          </ngc-lov>
        </div>
      </ngc-column>

      <ngc-column>
        <div style="padding-top:25px;">
          <ngc-button label="g.search" iconType="search" (click)='searchAuthorizedPersonnel()' accessEnableOn="r">
          </ngc-button>
        </div>
      </ngc-column>
    </ngc-row>
  </ngc-container>
  <ngc-container type="tab">
    <ngc-row>
      <ngc-column>
        <ngc-label color="red" entityAttribute="Customer.PDPANote">
          <!-- <ngc-label [ngStyle]="{'color':'red'}" label="Note: Due to PDPA with effect from X XXX 2022, SATS will only keep last 4 characters of IC/Airport Pass
                    Numbers in our systems."> -->
          <!-- 'font-size':'18px' -->
        </ngc-label>
      </ngc-column>
      <ngc-column column="4" align="right">
        <ngc-button value='admin.add.personnel' (click)="onAddPersonnel()" iconType="add" *ngIf="afterSearch">
        </ngc-button>
        <ngc-button value="g.exportToPDF" (click)="onGenerateReportCustomerReport($event)" *ngIf="recordsExist">
        </ngc-button>
        <ngc-button value="g.export.to.xls" (click)="onGenerateReportCustomerXLSReport($event)" *ngIf="recordsExist">
        </ngc-button>
      </ngc-column>
    </ngc-row>
    <ngc-row>
      <ngc-column>
        <ngc-label label=""></ngc-label>
      </ngc-column>
    </ngc-row>
    <ngc-row *ngIf="showTable">
      <ngc-column>

        <ngc-edittable #goTo formArrayName="authorizedPersonnelList">

          <ngc-data-column text="ad.contact" dataField="contractorName" [width]='100' [height]='50'>
            <ng-template let-data let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-lov formControlName='contractorName' [width]='280' upperCase='true' sourceId='CONTRACTOR_LIST'
                  title='admin.contractor' dataField='desc' (select)='onLOVSelect(group, data)' [validOnly]="true"
                  valueMember='desc'>
                  <ngc-data-column text='g.contractorCode' dataField='code' [width]='100'></ngc-data-column>
                  <ngc-data-column text='g.contractorName' dataField='desc' [width]='150'></ngc-data-column>
                </ngc-lov>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="admin.authorized.person.name" type="text" dataField="authorizedPersonnelName"
            [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-textarea [width]="130" [height]="80" #authorizedPersonnelName
                    formControlName="authorizedPersonnelName" upperCase="true" patternName='alphanumspace'
                    required='true' entityAttribute="Customer.AuthorisedPersonName">
                  </ngc-textarea>
                  <!-- (keyup)="onNameKeyUp($event, group)" -->
                  <!-- [width]="300" -->
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>


          <ngc-data-column entityAttribute="Customer.PersonalIdentificationNumber" text="ad.IC"
            dataField="authorizedPersonnelNumber" [width]="25" align="center" cellsAlign="center" type="text">
            <!-- entityAttribute="Customer.PersonalIdentificationNumber" -->
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-input *ngIf="authorizedPersonnelForm.get(['authorizedPersonnelList',group,'hkidFlag']).value"
                    entityAttribute="Customer.PersonalIdentificationNumber" #authorizedPersonnelName
                    formControlName="authorizedPersonnelNumber" upperCase="true">
                  </ngc-input>
                  <ngc-display *ngIf="!authorizedPersonnelForm.get(['authorizedPersonnelList',group,'hkidFlag']).value"
                    entityAttribute="Customer.PersonalIdentificationNumber" #authorizedPersonnelName
                    formControlName="authorizedPersonnelNumber" upperCase="true">
                  </ngc-display>
                  <!-- <a href="javascript:void(0)" (click)="onClick($event)">Possible Duplicates Exist</a> -->
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column entityAttribute="Customer.AirportPassNumber" text="ad.passno" dataField="airportPassNumber"
            [width]="25" align="center" cellsAlign="center" type="text">
            <!-- entityAttribute="Customer.AirportPassNumber" -->
            <!-- <ngc-data-column text="ad.passno" dataField="airportPassNumber" [width]="25" align="center" cellsAlign="center"> -->
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-alphanuminput formControlName="airportPassNumber" upperCase="true"
                    entityAttribute="Customer.AirportPassNumber">
                    <!-- #newAirportPassNumber
                    placeHolder="{{showTable && !newAirportPassNumber.disabled ? 'admin.last.four.characters' : ''}}" -->
                  </ngc-alphanuminput>
                  <!-- <ngc-input [minlength]="4" [maxlength]="4" formControlName="airportPassNumber" upperCase="true" #newAirportPassNumber
                    placeHolder="{{showTable && !newAirportPassNumber.disabled ? 'admin.last.four.characters' : ''}}">
                  </ngc-input> -->
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="ad.purpose" dataField="purpose" [width]="30" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-dropdownlist [width]="90" formControlName="purpose" sourceId="AgentPortal$Purpose"
                  [multiSelect]="true"
                  [disabled]="authorizedPersonnelForm.get(['authorizedPersonnelList',group,'flagCRUD']).value == 'R'"
                  required>
                </ngc-dropdownlist>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="ad.cargo" dataField="allowClearVALCargo" [width]="10" align="center"
            cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-checkbox formControlName="allowClearVALCargo" [width]="30"></ngc-checkbox>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="ad.signature" dataField="digitalSignature" [width]="25" align="center"
            cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ng-container>
                    <ngc-signaturepad formControlName="digitalSignature" uploadOnly="true"></ngc-signaturepad>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="admin.authorized.letter.date" dataField="authorizationLetterDate" [width]="25"
            align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-dateinput formControlName="authorizationLetterDate">
                  </ngc-dateinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="admin.authorized.letter.reference" dataField="authorizationLetterReference"
            [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-input formControlName="authorizationLetterReference" [maxlength]="15">
                  </ngc-input>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="haffaChopFlag" dataField="haffaChopFlag" entityAttribute="Customer.AuthRep.HaffaMember"
            [width]="10" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-checkbox formControlName="haffaChopFlag" [width]="30"></ngc-checkbox>
              </ng-container>
            </ng-template>
          </ngc-data-column>


          <ngc-data-column text="expiryDate" dataField="expiryDate" entityAttribute="Customer.AuthRep.ExpiryDate"
            [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-dateinput formControlName="expiryDate">
                  </ngc-dateinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="admin.lastupdatedby" dataField="lastUpdateByOn" [width]="25" align="center"
            cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-display formControlName="lastUpdateByOn" upperCase="true"></ngc-display>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="g.edit" dataField="edit" [width]='25' align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-link (linkClick)="onEditLink(group)" iconType="edit"></ngc-link>
              </ng-container>
            </ng-template>
          </ngc-data-column>

          <ngc-data-column text="ad.delete" dataField="delete" [width]='25' align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-link (linkClick)="deleteAuthorizedPersonnel(group)" iconType="delete">
                </ngc-link>
              </ng-container>
            </ng-template>
          </ngc-data-column>


          <ngc-data-column entityAttribute="Adm.AuthorisePersonnel.OtherCO" text="otherCompanyFlag"
            dataField="otherCompanyFlag" [width]='25' align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-link formControlName='otherCompanyFlag' (linkClick)="customerAuthorizePersonalList(group)">
                </ngc-link>
              </ng-container>
            </ng-template>
          </ngc-data-column>


        </ngc-edittable>

      </ngc-column>
    </ngc-row>

  </ngc-container>



  <ngc-report #reportWindow title="g.report" reportId='list_of_authorization' [reportParameters]='reportParameters'>
  </ngc-report>
  <ngc-report format='xls' #reportWindow1 title="g.report" reportId='list_of_authorization'
    [reportParameters]='reportParameters'>
  </ngc-report>
</form>

<form [formGroup]="CustomerAuthorizePersonnelList">
  <ngc-window #showPopUpWindow width="800" height="400" title="admin.company.list" [showCloseButton]="true">
    <ngc-container type="section">
      <ngc-row>
        <ngc-column column="4">
          <ngc-label value="admin.authorized.personnel" align="Center"></ngc-label>
        </ngc-column>
        <ngc-column>
          <ngc-display formControlName="authorizedPersonnelName" upperCase="true" color='blue'></ngc-display>
        </ngc-column>
      </ngc-row>
      <ngc-row>
        <ngc-column>
          <ngc-table>
            <tbody>
            </tbody>
            <thead align="Center">
              <tr>
                <th [width]="500">
                  <ngc-label value="g.companyCode" align="Center"></ngc-label>
                </th>
                <th [width]="100" align="Center">
                  <ngc-label value="g.companyName" align="Center"></ngc-label>
                </th>
              </tr>
            </thead>
            <tbody align="center" formArrayName="capl">
              <tr *ngFor="let item of CustomerAuthorizePersonnelList.get('capl').controls; let index=index"
                [formGroupName]="index">
                <td align="center">
                  {{item.controls.companyCode.value}}
                </td>
                <td align="center">
                  {{item.controls.companyName.value}}
                </td>
              </tr>

            </tbody>


          </ngc-table>

        </ngc-column>
      </ngc-row>

    </ngc-container>
  </ngc-window>
</form>

<app-duplicatenamepopup #duplicateNamePopup (onClose)="onClose($event)" (onCancelClear)="onCancelClear($event)">
</app-duplicatenamepopup>
<!-- (onNameSelect)="onNameSelect($event)" -->

<!-- <ngc-window #duplicateEntry [width]="1000" [height]="680" title="Possible Duplicate Entries" [showCloseButton]="false">
  <ngc-container>
    <ngc-row>
      <ngc-column>
        <ngc-table>
          <tr style="background-color: hsl(0, 0%, 75%);">
            <th width="50%">
              <ngc-label label="Company Code"></ngc-label>
            </th>
            <th width="50%">
              <ngc-label label="APL"></ngc-label>
            </th>
          </tr>
        </ngc-table>
      </ngc-column>
      <ngc-column>
      </ngc-column>
    </ngc-row>

    <ngc-row *ngFor="let item of itemtest">
      <ngc-column>
        <ngc-table>
          <tr style="background-color: grey;">
            <th width="25%">
              <ngc-label label="S/N"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="admin.authorized.person.name"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="ad.IC"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="ad.passno"></ngc-label>
            </th>
          </tr>
          <tbody>
            <tr>
              <td>1</td>
              <td>YEO KOK THYE</td>
              <td>123F</td>
              <td>2323</td>
            </tr>
          </tbody>

          <tr>
            <th colspan="4" style="text-decoration: underline !important;">
              <ngc-label label="Possible Duplicate Entries">
              </ngc-label>
            </th>
          </tr>
          <tr style="background-color:#516bc0;">
            <th width="25%">
              <ngc-label label="ad.contact"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="admin.authorized.person.name"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="ad.IC"></ngc-label>
            </th>
            <th width="25%">
              <ngc-label label="ad.passno"></ngc-label>
            </th>
          </tr>
          <tbody>
            <tr>
              <td>1</td>
              <td>YEO KOK THYE</td>
              <td>123F</td>
              <td>2323</td>
            </tr>
          </tbody>
          <tbody>
            <tr *ngIf="SaveClicked">
              <td>a</td>
              <td>b</td>
              <td>c</td>
              <td>d</td>
              <td>e</td>
              <td>f</td>
              <td>g</td>
            </tr>
          </tbody>
        </ngc-table>
      </ngc-column>
    </ngc-row>
  </ngc-container>

  <ngc-window-footer>
    <ngc-container type="tab">
      <ngc-row>
        <ngc-column align="right">
          <ngc-button (click)="onSaveNew()" value="Save" iconType="confirm">
          </ngc-button>
          <ngc-button (click)="cancel()" value="flight.cancel"></ngc-button>
        </ngc-column>
      </ngc-row>
    </ngc-container>
  </ngc-window-footer>

</ngc-window> -->