<form novalidate [formGroup]="screeningform">
  <ngc-titlebar title="export.title.auto.kc.target.conf" (save)="saveAutoKCConfig($event)">
  </ngc-titlebar>

  <ngc-container type="section">
    <ngc-row>
      <ngc-column align="left">
        <ngc-label value="autokc.target.setup"></ngc-label>
      </ngc-column>
      <ngc-column align="right">
        <ngc-button (click)="addConfig($event)" value="g._add"></ngc-button>
      </ngc-column>
    </ngc-row>
    <ngc-row>
      <ngc-column>
        <ngc-edittable formArrayName="autoKCTargetConfigSetUp">
          <ngc-data-column text="g.shipmentType" dataField="handledAs" [width]="40">
            <ng-template let-data let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-dropdownlist formControlName='handledAs' [width]='140' upperCase='true' sourceId='Shpmgmt$Auto_KC_ShipmentType' title='g.shipmentType'
                  required [noCache]="true">
                </ngc-dropdownlist>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="flight.flightType" dataField="flightType" [width]="40">
            <ng-template let-data let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ngc-dropdownlist formControlName='flightType' [width]='140' upperCase='true' sourceId='Flight$Flight_Type' required [noCache]="true">
                </ngc-dropdownlist>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.target" dataField="targetPercentage" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <!-- <ngc-input formControlName="target">
                  </ngc-input> -->
                  <ngc-numberinput [width]="70" [min]='0' [max]='100' formControlName="targetPercentage" digits="7" decimalDigits="0" required>
                  </ngc-numberinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.buffer" dataField="bufferPercentage" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <!-- <ngc-input formControlName="buffer">
                  </ngc-input> -->
                  <ngc-numberinput [width]="70" [min]='0' [max]='100' formControlName="bufferPercentage" digits="7" decimalDigits="0">
                  </ngc-numberinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.reset.time" dataField="resetTimeOfDay" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-timeinput [width]="100" formControlName="resetTimeOfDay" dataType="string"></ngc-timeinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.min.connection.time" dataField="minConnectionTime" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-numberinput formControlName="minConnectionTime" decimalDigits="0" [min]='0'></ngc-numberinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.min.pcs" dataField="minPieces" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-piecesinput formControlName="minPieces" [min]='0'></ngc-piecesinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.max.pcs" dataField="maxPieces" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-piecesinput formControlName="maxPieces"></ngc-piecesinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.min.weight.kg" dataField="minWeight" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-weightinput formControlName="minWeight"></ngc-weightinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="autokc.max.weight.kg" dataField="maxWeight" [width]="25" align="center" cellsAlign="center">
            <ng-template let-name="name" let-group="group">
              <ng-container [formGroupName]="group">
                <ng-container>
                  <ngc-weightinput formControlName="maxWeight" [min]='0'></ngc-weightinput>
                </ng-container>
              </ng-container>
            </ng-template>
          </ngc-data-column>
          <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
            <ng-template let-data let-name="name" let-group="group">
              <ng-container [formGroupName]="group" align="center">
                <ngc-link (linkClick)="onAutoKCSetupConfigDelete(group)" iconType="delete">
                  <ngc-i18n value="g.delete"></ngc-i18n>
                </ngc-link>
              </ng-container>
            </ng-template>
          </ngc-data-column>
        </ngc-edittable>
      </ngc-column>
    </ngc-row>
  </ngc-container>
  <ngc-row>
    <ngc-column></ngc-column>
  </ngc-row>
  <ngc-container type="tab">
    <ngc-row>
      <ngc-column [column]="2.6">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.shc.exclusion"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addShcGrp($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-edittable formArrayName="autoKCSHCExclusion" [width]="70">
              <ngc-data-column text="autokc.shc.group" dataField="shcGroup" [width]="70" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='shcGroup' [width]='200' upperCase='true' sourceId='SHC_HANDLING_LOADED' displayMember='code'
                      title='autokc.shc.group' sourceType='query' [noCache]="true" required>
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group" align="center">
                    <ngc-link (linkClick)="onAutoKCSHCDelete(group)" iconType="delete">
                      <ngc-i18n value="g.delete"></ngc-i18n>
                    </ngc-link>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
            </ngc-edittable>
          </ngc-column>
        </ngc-row>
      </ngc-column>
      <ngc-column [column]="0.5"></ngc-column>
      <ngc-column [column]="2.6">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.country.exclusions"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addCountry($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-edittable formArrayName="autoKCCountryExclusion" [width]="100">
              <ngc-data-column text="g.type" dataField="cargoInCountryAs" [width]="70" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='cargoInCountryAs' [width]='200' upperCase='true' sourceId='Shpmgmt$CargoInCountryAs' title='autokc.airline.group'
                      [noCache]="true" required>
                    </ngc-dropdownlist>
                    <!-- <ngc-input type=text formControlName='cargoInCountryAs'> </ngc-input> -->

                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.country" dataField="countryList" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='countryList' [width]='200' upperCase='true' multiSelect="true" sourceId='COUNTRYDROPDOWN'
                      sourceType="query" [noCache]="true" displayMember="code" required>
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group" align="center">
                    <ngc-link (linkClick)="onAutoKCCountryExclusionDelete(group)" iconType="delete">
                      <ngc-i18n value="g.delete"></ngc-i18n>
                    </ngc-link>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
            </ngc-edittable>
          </ngc-column>
        </ngc-row>
      </ngc-column>
      <ngc-column [column]="0.5">
      </ngc-column>
      <ngc-column [column]="2.5">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.airline.inclusions"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addAirlineInc($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-edittable formArrayName="autoKCAirlineInclusions" [width]="100">
              <ngc-data-column text="export.shp.type" dataField="handledAs" [width]="100">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='handledAs' [width]='140' upperCase='true' sourceId='Shpmgmt$Auto_KC_ShipmentType' title='g.shipmentType'
                      required [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.airline.group" dataField="carrierGroupList" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='carrierGroupList' [width]='100' upperCase='true' multiSelect="true" sourceId='CARRIER_GROUP'
                      sourceType="query" [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.airline" dataField="carrierList" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='carrierList' [width]='100' upperCase='true' multiSelect="true" sourceId='CARRIER' sourceType="query"
                      [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group" align="center">
                    <ngc-link (linkClick)="onAutoKCAirlineInclusionsDelete(group)" iconType="delete">
                      <ngc-i18n value="g.delete"></ngc-i18n>
                    </ngc-link>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
            </ngc-edittable>
          </ngc-column>
        </ngc-row>
      </ngc-column>
      <ngc-column [column]="0.5">
      </ngc-column>
      <ngc-column [column]="2.5">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.airline.exclusions"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addAirlineExc($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-edittable formArrayName="autoKCAirlineExclusions" [width]="100">
              <ngc-data-column text="export.shp.type" dataField="handledAs" [width]="100">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='handledAs' [width]='140' upperCase='true' sourceId='Shpmgmt$Auto_KC_ShipmentType' title='g.shipmentType'
                      required [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.airline.group" dataField="carrierGroupList" [width]="50" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='carrierGroupList' [width]='100' upperCase='true' multiSelect="true" sourceId='CARRIER_GROUP'
                      sourceType="query" [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.airline" dataField="carrierList" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName='carrierList' [width]='100' upperCase='true' multiSelect="true" sourceId='CARRIER' sourceType="query"
                      [noCache]="true">
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group" align="center">
                    <ngc-link (linkClick)="onAutoKCAirlineExclusionsDelete(group)" iconType="delete">
                      <ngc-i18n value="g.delete"></ngc-i18n>
                    </ngc-link>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
            </ngc-edittable>
          </ngc-column>
        </ngc-row>
      </ngc-column>
    </ngc-row>
  </ngc-container>
  <ngc-container type="tab">
    <ngc-row>
      <ngc-column [column]="4">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.terminal.peak.hours"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addTerminalPeakHours($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-edittable formArrayName="autoKCConfigTerminal" [width]="200">
              <ngc-data-column text="g.terminal" dataField="terminalCode" [width]="50" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-dropdownlist formControlName="terminalCode" sourceId="WAREHOUSE_TERMINAL" sourceType="query" cellsAlign required>
                    </ngc-dropdownlist>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.from.time" dataField="fromTime" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-timeinput [width]="100" formControlName="fromTime" dataType="string" required>
                    </ngc-timeinput>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.to.time" dataField="toTime" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-timeinput [width]="100" formControlName="toTime" dataType="string" required>
                    </ngc-timeinput>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.exempted" dataField="isExempted" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-checkbox [width]="50" formControlName="isExempted" align="center"></ngc-checkbox>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="autokc.load.factor" dataField="loadFactor" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group">
                    <ngc-weightinput [width]="100" formControlName="loadFactor" required></ngc-weightinput>
                  </ng-container>
                </ng-template>
              </ngc-data-column>
              <ngc-data-column text="g.delete" dataField="delete" [width]="100" align="center">
                <ng-template let-data let-name="name" let-group="group">
                  <ng-container [formGroupName]="group" align="center">
                    <ngc-link (linkClick)="onAutoKCTerminalDelete(group)" iconType="delete">
                      <ngc-i18n value="g.delete"></ngc-i18n>
                    </ngc-link>
                  </ng-container>
                </ng-template>
              </ngc-data-column>

            </ngc-edittable>
          </ngc-column>
        </ngc-row>
      </ngc-column>
      <ngc-column [column]="2"></ngc-column>
      <ngc-column [column]="6">
        <ngc-row>
          <ngc-column>
            <ngc-label value="autokc.notification.setting"></ngc-label>
          </ngc-column>
          <ngc-column align="right">
            <ngc-button (click)="addNotifications($event)" value="g._add"></ngc-button>
          </ngc-column>
        </ngc-row>
        <ngc-row>
          <ngc-column>
            <ngc-table>
              <thead>
                <tr>
                  <th>
                    <ngc-label value="autokc.airline.group"></ngc-label>
                  </th>
                  <th>
                    <ngc-label value="g.airline"></ngc-label>
                  </th>
                  <th>
                    <ngc-label value="g.type"></ngc-label>
                  </th>
                  <th>
                    <ngc-label value="g.address"></ngc-label>
                  </th>
                  <th>
                    <ngc-label value="g.action"></ngc-label>
                  </th>
                  <th>
                    <ngc-label value="g.delete"></ngc-label>
                  </th>
                </tr>
              </thead>
              <tbody formArrayName="autoKCNotification" align="center">
                <ng-container *ngFor="let item of screeningform.controls.autoKCNotification.controls; let index=index" [formGroupName]="index">
                  <tr>
                    <td [attr.rowspan]="item.controls.notificationAddressDetails.length + 1">
                      <ngc-dropdownlist formControlName="carrierGroup" sourceId="CARRIER_GROUP" sourceType="query" cellsAlign [width]='80'>
                      </ngc-dropdownlist>
                      <!--<ngc-display formControlName="contType" *ngIf="item.get('contType').value"></ngc-display>-->
                    </td>
                    <td [attr.rowspan]="item.controls.notificationAddressDetails.length + 1">
                      <ngc-dropdownlist formControlName='carrierCodeList' [width]='100' upperCase='true' multiSelect="true" sourceId='CARRIER'
                        sourceType="query" [noCache]="true">
                      </ngc-dropdownlist>
                    </td>
                    <td [attr.rowspan]="item.controls.notificationAddressDetails.length + 1">
                      <ngc-lov formControlName="notificationType" sourceId="LOV_CONTACTTYPE_CUSTOMER"  title="g.contacts"  dataField="code" required
                        [width]='100'>
                        <ngc-data-column text="export.contact.code" dataField="code" [width]="80"></ngc-data-column>
                          <ngc-data-column text="export.contact.description" [width]="150" dataField="desc">
                          </ngc-data-column>
                      </ngc-lov>
                    </td>
                    <td colspan="2" [ngClass]="{ 'contact-info-blank': item.controls.notificationAddressDetails.length > 0 ? true : false }">
                    </td>
                    <td align="center" [attr.rowspan]="item.controls.notificationAddressDetails.length + 1">
                      <ngc-link (linkClick)="onNotificationDelete(index)" iconType="delete">
                        <ngc-i18n value="g.delete"></ngc-i18n>
                      </ngc-link>
                    </td>
                  </tr>
                  <ng-container formArrayName="notificationAddressDetails">
                    <tr *ngFor="let sitem of item.controls.notificationAddressDetails.controls let sindex=index" [formGroupName]="sindex">
                      <td>
                        <ngc-input formControlName="notificationAddress" required width="350" [maxlength]='65'>
                        </ngc-input>
                      </td>
                      <td>
                        <ngc-button iconType="add" priority="quaternary" (click)="addNotificationsDetails(index , sindex)" *ngIf="screeningform.get(['autoKCNotification',index,'notificationAddressDetails']).length == (sindex + 1)">
                        </ngc-button>
                        <ngc-link (linkClick)="onNotificationDtlDelete(index, sindex)">
                          <ngc-icon type="delete" value="true" true-color="black"></ngc-icon>
                        </ngc-link>
                      </td>
                    </tr>
                  </ng-container>

                </ng-container>
              </tbody>
            </ngc-table>

         
          </ngc-column>
        </ngc-row>
      </ngc-column>
    </ngc-row>
  </ngc-container>
</form>