<form [formGroup]="transshipmentHandlingSummaryForm">
  <ngc-titlebar title="ThroughTransit.WorkingList" (clear)="onClear()"></ngc-titlebar>
  <ngc-page>
    <ngc-page-header [height]="100">
      <ngc-container type="section">
        <ngc-row>
          <ngc-column>
            <ngc-label value="transhipment.by"></ngc-label>
            <div>
              <ngc-dropdownlist accessEnableOn="r" formControlName="by" sourceId="Transshipment$TransshipmentType"
                [width]="150" required [autoSelect]="true">
              </ngc-dropdownlist>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="flight.fromDate"></ngc-label>
            <div>
              <ngc-datetimeinput accessEnableOn="r" formControlName="dateTimeFrom" [showTimeButton]="true"
                [showCalendarButton]="true" [width]="150" required></ngc-datetimeinput>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="flight.toDate"></ngc-label>
            <div>
              <ngc-datetimeinput accessEnableOn="r" formControlName="dateTimeTo" [showTimeButton]="true"
                [showCalendarButton]="true" [width]="150" required>
              </ngc-datetimeinput>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="flight.flightKey"></ngc-label>
            <div>
              <ngc-flightkeyinput accessEnableOn="r" formControlName="flightKey" [width]="150"></ngc-flightkeyinput>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="flight.flightDate"></ngc-label>
            <div>
              <ngc-datetimeinput accessEnableOn="r" formControlName="flightDate" [showCalendarButton]="true"
                [width]="150">
              </ngc-datetimeinput>
            </div>
          </ngc-column>

          <ngc-column>
            <ngc-label value="coolport.carriergroup"></ngc-label>
            <div>
              <ngc-dropdownlist accessEnableOn="r" formControlName="carrierGroup" sourceId="CARRIER_GROUP"
                sourceType="query" [width]="140">
              </ngc-dropdownlist>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="carrier"></ngc-label>
            <div>
              <ngc-lov accessEnableOn="r" formControlName="carrier" upperCase='true' sourceId='CARRIER'
                title="g.carrierCode" [sourceParameters]="carrierGroupCodeParam" dataField='code' [width]="110"
                [noCache]="true" [disabled]="carrier">
                <ngc-data-column text="g.carrierCode" [width]="100" dataField="code"></ngc-data-column>
                <ngc-data-column text="g.carrierName" [width]="100" dataField="desc"></ngc-data-column>
              </ngc-lov>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="transferType"></ngc-label>
            <div>
              <ngc-dropdownlist accessEnableOn="r" sourceId='WH_TRANSFER_TYPE_TT' sourceType='query'
                formControlName="transferType" [width]="140" [noCache]="true" [multiSelect]="true"></ngc-dropdownlist>
            </div>
          </ngc-column>
          <ngc-column>
            <ngc-label value="event.SHCPusrpose"></ngc-label>
            <div>
              <ngc-dropdownlist accessEnableOn="r" sourceType='query' formControlName="shcByPurpose"
                 sourceId='WH_SHC_HANDLING_GP'  [width]="140"></ngc-dropdownlist>
            </div>
          </ngc-column>
          <ngc-column verticalAlign="bottom">
            <ngc-button accessEnableOn="r" (click)="getFlightList()" value="g.search"></ngc-button>
          </ngc-column>
        </ngc-row>
      </ngc-container>
    </ngc-page-header>
    <ngc-container formArrayName="flightList">
      <ngc-row *ngFor="let item of transshipmentHandlingSummaryForm.get('flightList').controls; let index=index"
        [formGroupName]="index">
        <ngc-column [column]='2'>
          <ngc-container>
            <ngc-row>
              <ngc-column align="left" verticalAlign="center">
                <div style="height: 105px;">
                  <div>
                    <ngc-label value=""></ngc-label>
                  </div>
                  <ngc-radiobutton formControlName="select" [groupName]='sel' (click)="selectionRow(index,$event)"
                    checked="false">
                  </ngc-radiobutton>
                </div>
              </ngc-column>
              <ngc-column align="center" verticalAlign="center">
                <div class="square" *ngIf="item.get('finalized').value"
                  style="height: 105px;border: 3px solid #aaaaaa;margin: 5px;background: #d3d3d3;"
                  (click)="redirectToNextPage(item)">
                  <ngc-label formControlName="flightKey"></ngc-label>
                  <div>
                    <ngc-display formControlName="airport"></ngc-display>
                  </div>
                  <div>(S)
                    <ngc-display formControlName="standardEstimatedDateTime" [onlyTime]="true"></ngc-display>
                    /
                    <ngc-display [value]="convertDate(item.get('standardEstimatedDateTime').value)"></ngc-display>
                  </div>
                  <div *ngIf="item.get('etaWithDate') != null && item.get('etaWithDate').value">
                    (E)
                    <ngc-display formControlName="etaWithDate"></ngc-display>
                  </div>
                </div>
                <div class="square" *ngIf="!item.get('finalized').value"
                  style="height: 105px;border: 3px solid #aaaaaa;margin: 5px;" (click)="redirectToNextPage(item)">
                  <ngc-label formControlName="flightKey"></ngc-label>
                  <div>
                    <ngc-display formControlName="airport"></ngc-display>
                  </div>
                  <div>(S)
                    <ngc-display formControlName="standardEstimatedDateTime" [onlyTime]="true"></ngc-display>
                    /
                    <ngc-display [value]="convertDate(item.get('standardEstimatedDateTime').value)"></ngc-display>
                  </div>
                  <div *ngIf="item.get('etaWithDate') != null && item.get('etaWithDate').value">
                    (E)
                    <ngc-display formControlName="etaWithDate"></ngc-display>
                  </div>
                </div>
              </ngc-column>
            </ngc-row>
          </ngc-container>
        </ngc-column>
        <ngc-column [column]='10' align="left">
          <ngc-container formArrayName="flightList">
            <ngc-row>
              <ngc-column [column]="2" align="center" verticalAlign="center"
                *ngFor=" let seconditem of item.get('flightList').controls; let subindex=index"
                [formGroupName]="subindex">
                <div class="square">
                  <div class="innersquare">

                    <ngc-label formControlName="flightKey"></ngc-label> -
                    <ngc-display formControlName="standardEstimatedDateTime" [onlyDate]="true"></ngc-display>

                  </div>
                  <div class="innersquare">

                    <ngc-display formControlName="airport"></ngc-display> -
                    <ngc-display formControlName="standardEstimatedDateTime" [onlyTime]="true"></ngc-display>

                  </div>
                  <div class="innersquarewithboundry" formArrayName="transferTypeShipments">
                    <div class="test"
                      *ngFor="let subItem of seconditem.getList('transferTypeShipments'); let subIndex=index"
                      [formGroupName]="subIndex">
                      <ngc-label formControlName="transferType"></ngc-label>
                      <div>
                        (<ngc-label [value]="subItem.get('number').value"></ngc-label>)
                      </div>
                    </div>

                  </div>
                </div>
              </ngc-column>
            </ngc-row>
          </ngc-container>
        </ngc-column>
      </ngc-row>

    </ngc-container>
    <ngc-container>
      <ngc-row>
        <ngc-column>
          <div>
            <ngc-label value=""></ngc-label>
            <ngc-label value=""></ngc-label>
          </div>
        </ngc-column>
      </ngc-row>
    </ngc-container>

    <ngc-report format='pdf' #inboundReportWindow title="export.transhipment.summary"
       reportId='InboundTranshipmentWorkingList'  [reportParameters]='reportParameters'></ngc-report>
    <ngc-report format='pdf' #outboundReportWindow title="export.transhipment.summary"
       reportId='OutboundTranshipmentWorkingList'  [reportParameters]='reportParameters'></ngc-report>
    <ngc-report format='pdf' #shortTransitReportWindow title="export.short.transit"
       reportId='InboundTranshipmentWorkingList'  [reportParameters]='reportParameters'></ngc-report>
  </ngc-page>

</form>
<ngc-footer>
  <ngc-row>
    <ngc-column column="1.5">
      <ngc-button label="Add Outgoing Flight" (click)='onAddOutgoingFlight()'> </ngc-button>
    </ngc-column>

  </ngc-row>
</ngc-footer>