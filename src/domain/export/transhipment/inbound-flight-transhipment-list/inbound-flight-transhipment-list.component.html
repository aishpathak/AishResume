<form [formGroup]="inboundFlightTranshipmentListSearch">
  <ngc-titlebar title="Inbound Flight Transhipment List" (clear)="onClear()" (save)="onSave($event)"
    (cancel)="navigateToPreviousPage()"></ngc-titlebar>
  <ngc-container type="header">
    <ngc-row>
      <ngc-column [column]="2">
        <ngc-label value="flight.Flight"></ngc-label>
        <div>
          <ngc-flightkeyinput accessEnableOn="r" formControlName="flightKey" [width]="150" required>
          </ngc-flightkeyinput>
        </div>
      </ngc-column>
      <ngc-column [column]="2">
        <ngc-label value="g.date"></ngc-label>
        <div>
          <ngc-datetimeinput accessEnableOn="r" formControlName="flightDate" [showCalendarButton]="true" [width]="75"
            required>
          </ngc-datetimeinput>
        </div>
      </ngc-column>
      <ngc-column *ngIf='showTableFlag' [column]="1">
        <ngc-label value="flight.sta"></ngc-label>
        <div>
          <ngc-display formControlName="sta" [width]="75" [onlyTime]="true">
          </ngc-display>
        </div>
      </ngc-column>
      <ngc-column *ngIf='showTableFlag' [column]="1">
        <ngc-label value="flight.eta"></ngc-label>
        <div>
          <ngc-display formControlName="eta" [width]="75" [onlyTime]="true">
          </ngc-display>
        </div>
      </ngc-column>
      <ngc-column *ngIf='showTableFlag' [column]="1">
        <ngc-label value="flight.ata"></ngc-label>
        <div>
          <ngc-display formControlName="ata" [width]="75" [onlyTime]="true">
          </ngc-display>
        </div>
      </ngc-column>
      <ngc-column [column]="1">
        <ngc-label label=''></ngc-label>
        <div>
          <ngc-button accessEnableOn="r" (click)="getInboundFlightTranshipmentList()" value="g.search"></ngc-button>
        </div>
      </ngc-column>
    </ngc-row>
  </ngc-container>
</form>

<form [formGroup]="inboundFlightTranshipmentList">
  <ngc-container *ngIf='showTableFlag'>
    <ngc-row>
      <ngc-column>
        <ngc-table>
          <thead align="center">
            <tr>
              <th [width]="10" rowspan="2">
                <ngc-label label="g.sNo"></ngc-label>
              </th>
              <th [width]="50" align="center" rowspan="2">
                <ngc-label label="g.shipmentNumber"></ngc-label>
              </th>
              <th rowspan="2" [width]="40">
                <ngc-label label="g.origin"></ngc-label>
              </th>
              <th rowspan="2" [width]="50">
                <ngc-label label="g.destination"></ngc-label>
              </th>
              <th align="center" rowspan="2">
                <ngc-label label="g.shc"></ngc-label>
              </th>
              <th [width]="10" align="center" rowspan="2">
                <ngc-label label="g.pieces"></ngc-label>
              </th>
              <th [width]="10" align="center" rowspan="2">
                <ngc-label label="g.weight"></ngc-label>
              </th>
              <th [width]="10" align="center" rowspan="2">
                <ngc-label label="CC"></ngc-label>
              </th>
              <th colspan="10" align="center">
                <ngc-label label="inbound.transhipment.flightlist.connectingFlt"></ngc-label>
              </th>
            </tr>
            <tr>
              <th align="center">
                <ngc-label label="g.flightKey" align="center"></ngc-label>
              </th>
              <th align="center">
                <ngc-label label="g.FlightDate"></ngc-label>
              </th>
              <th align="center">
                <ngc-label label="flight.segment"></ngc-label>
              </th>
              <th align="center">
                <ngc-label label="inbound.transhipment.flightlist.tfdPcs"></ngc-label>
              </th>
              <th align="center">
                <ngc-label label="inbound.transhipment.flightlist.tfdWgt"></ngc-label>
              </th>
              <th align="center">
                <ngc-label label="inbound.transhipment.flightlist.timeDiff"></ngc-label>
              </th>
              <th align="center" rowspan="2">
                <ngc-label label="export.transfer.type"></ngc-label>
              </th>
              <th align="center" rowspan="2">
                <ngc-label label="g.clear"></ngc-label>
              </th>
              <th align="center" rowspan="2">
                <ngc-label label="inbound.transhipment.flightlist.multiflt"></ngc-label>
              </th>
              <th align="center" rowspan="2">
                <ngc-label label=""></ngc-label>
              </th>
            </tr>
          </thead>
          <tbody formArrayName="uldInfo">

            <ng-container *ngFor="let item of inboundFlightTranshipmentList.controls.uldInfo.controls let index=index"
              [formGroupName]="index">
              <tr [ngStyle]="{'background-color': '#999DA0'}">
                <td colspan="18">
                  <ngc-display formControlName="uldKey"></ngc-display>
                </td>
              </tr>
              <ng-container formArrayName="shipmentInfo">
                <ng-container *ngFor="let sitem of item.controls.shipmentInfo.controls; let sindex=index"
                  [formGroupName]="sindex">
                  <!--</tr>-->
                  <td align="center" [width]="10">
                    <ngc-display formControlName="sequence" cellalign="middle"></ngc-display>
                  </td>
                  <td align="center" [width]="60">
                    <ngc-display formControlName="shipmentNumber" cellalign="middle"></ngc-display>
                  </td>
                  <td align="center">
                    <ngc-display formControlName="origin" cellalign="middle"></ngc-display>
                  </td>
                  <td align="center">
                    <ngc-display formControlName="destination" cellalign="middle"></ngc-display>
                  </td>
                  <td align="center">
                    <ngc-display formControlName="shc" cellalign="middle"></ngc-display>
                  </td>
                  <td align="right">
                    <ngc-display formControlName="pieces" cellalign="middle"></ngc-display>
                  </td>
                  <td align="right">
                    <ngc-display formControlName="weight" cellalign="middle"></ngc-display>
                  </td>
                  <td align="right">
                    <ngc-display formControlName="constraintCode" cellalign="middle"></ngc-display>
                  </td>
                  <td colspan="11"></td>
                  <ng-container formArrayName="connectingFlightInfo">
                    <ng-container *ngFor="let titem of sitem.controls.connectingFlightInfo.controls; let tindex=index"
                      [formGroupName]="tindex">
                      <tr>
                        <td colspan="8"></td>
                        <td align="center">
                          <ngc-flightkeyinput formControlName="flightKey" [width]="150"
                            (modelChange)="onFlightChange($event ,index,sindex,tindex )"
                            [disabled]="!titem.value.bookingAllowed || titem.value.flagCRUD == 'R' || titem.value.flagCRUD == 'U'">
                          </ngc-flightkeyinput>
                        </td>
                        <td align="center">
                          <ngc-datetimeinput formControlName="flightDate" maxlength="60"
                            (modelChange)="onChangeSegment($event ,index,sindex,tindex ,titem.value.flightKey)"
                            [disabled]="!titem.value.bookingAllowed || titem.value.flagCRUD == 'R' || titem.value.flagCRUD == 'U'">
                          </ngc-datetimeinput>
                        </td>
                        <td align="center">
                          <ngc-dropdownlist sourceId="LOADSHIPMENT_SEGMENT" [autoSelect]="true" [noBlank]="true"
                            [width]='70' formControlName='segment' [noCache]="true"
                            [sourceParameters]="{ 'parameter1': titem.value.flightKey,'parameter2': titem.value.flightDate}"
                            [width]="50" sourceType="query" (select)=setSegmentValue($event)
                            [disabled]="!titem.value.bookingAllowed || titem.value.flagCRUD == 'R' || titem.value.flagCRUD == 'U'">
                          </ngc-dropdownlist>
                        </td>
                        <td align="right">
                          <ngc-piecesinput formControlName="pieces" [width]="50"
                            [disabled]="!titem.value.bookingAllowed">
                          </ngc-piecesinput>
                        </td>
                        <td align="right">
                          <ngc-weightinput formControlName="weight" [width]="90"
                            [disabled]="!titem.value.bookingAllowed">
                          </ngc-weightinput>
                        </td>
                        <td align="center">
                          <ngc-display formControlName="timeDiff" [onlyTime]="true"
                            [disabled]="!titem.value.bookingAllowed"></ngc-display>
                        </td>
                        <td align="center">
                          <ngc-dropdownlist sourceId='SQL_ADVICE_TRANSFER_TYPE' [noCache]='false' sourceType='query'
                            formControlName="transferType" [width]="70" [disabled]="!titem.value.bookingAllowed">
                          </ngc-dropdownlist>
                        </td>
                        <td align="center">
                          <ngc-link (linkClick)="onDelete(index,sindex,tindex,titem)" iconType="delete"
                            [disabled]="!titem.value.bookingAllowed">
                            <ngc-i18n value="g.delete"></ngc-i18n>
                          </ngc-link>
                        </td>
                        <td>
                          <ngc-link (linkClick)="onSelectMultiflight(index,sindex,tindex)"
                            *ngIf="sitem.get('bookingInfo').controls.length > 0"
                            [disabled]="!titem.value.bookingAllowed">
                            <ngc-i18n value="Select Flight"></ngc-i18n>
                          </ngc-link>
                        </td>
                        <td align="center">
                          <ngc-button iconType="add" priority="quaternary"
                            *ngIf="item.get(['shipmentInfo',sindex,'connectingFlightInfo']).length == (tindex+1)  && item.get('uldKey').value == 'BULK'"
                            (click)="onActivityAddRow(index ,sindex ,tindex)">
                          </ngc-button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-container>
          </tbody>
        </ngc-table>
      </ngc-column>
    </ngc-row>
  </ngc-container>
</form>

<form [formGroup]="bookingInfoForm">
  <ngc-window #showPopUpWindow1 width="1100" height="500" title="inbound.transhipment.flightlist.fblFltInfo"
    [showCloseButton]="true">
    <ngc-container type="section" align="Center">
      <ngc-row>
        <ngc-column>
          <ngc-table align="Center">
            <thead align="Center">
              <tr>
                <th [width]="10" rowspan="2">
                  <ngc-label label="g.select"></ngc-label>
                </th>
                <th [width]="10" rowspan="2">
                  <ngc-label label="inbound.transhipment.flightlist.fblFlt"></ngc-label>
                </th>
                <th [width]="10" rowspan="2">
                  <ngc-label label="inbound.transhipment.flightlist.fblPcs"></ngc-label>
                </th>
                <th [width]="10" rowspan="2">
                  <ngc-label label="inbound.transhipment.flightlist.unloadingPoint"></ngc-label>
                </th>
              </tr>
            </thead>
            <tbody align="center" formArrayName='bookingInfoFormList'>
              <ng-container *ngFor="let item of bookingInfoForm.controls.bookingInfoFormList.controls let index=index"
                [formGroupName]="index">
                <tr>
                  <td>
                    <ngc-radiobutton formControlName="select" groupName='sel' [width]="10">
                    </ngc-radiobutton>
                  </td>
                  <td>
                    <ngc-display formControlName="flightKey"></ngc-display> /
                    <ngc-display formControlName="flightDate" dataType="date" [onlyDate]="true"></ngc-display>
                  </td>
                  <td>
                    <ngc-display formControlName="pieces"></ngc-display>/
                    <ngc-display formControlName="weight"></ngc-display>
                  </td>
                  <td>
                    <ngc-display formControlName="unloadingPoint"></ngc-display>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </ngc-table>
        </ngc-column>
      </ngc-row>
      <ngc-row>
        <ngc-column align="right">
          <ngc-button value="Ok" (click)='onSelectFlight()'>
          </ngc-button>
        </ngc-column>
      </ngc-row>
    </ngc-container>
  </ngc-window>


</form>